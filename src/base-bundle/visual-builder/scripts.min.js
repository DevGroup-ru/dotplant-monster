!function(e){function t(r){if(n[r])return n[r].exports;var a=n[r]={exports:{},id:r,loaded:!1};return e[r].call(a.exports,a,a.exports,t),a.loaded=!0,a.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}n(32);var a=n(11),i=r(a);window.FrontendMonster=new i["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(3),u=r(o),s=function(){function e(t,n){a(this,e),this.visualBuilder=t,this.name=n,this.target=$(this.visualBuilder.settings["frame-selector"])[0].contentWindow}return i(e,[{key:"activate",value:function(){this.name!==this.visualBuilder.currentEnvironment&&this.visualBuilder.currentEnvironment&&this.visualBuilder.environments.get(this.visualBuilder.currentEnvironment).deactivate()}},{key:"deactivate",value:function(){this.visualBuilder.clearStackable()}},{key:"sendMessage",value:function(e,t){return u["default"].sendMessage(this.target,e,t)}},{key:"pageChanged",value:function(){}},{key:"target$",get:function(){return this.target.$}}]),e}();t["default"]=s},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(){n(this,e)}return r(e,[{key:"serializeNode",value:function(e){}},{key:"initializeEditable",value:function(e){}}],[{key:"frame$",get:function(){return window.$}}]),e}();t["default"]=a},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(){n(this,e)}return r(e,null,[{key:"bindMessageListener",value:function(t){var n=function(n){var r=null;r=e.isIe?JSON.parse(n.data):n.data,t[r.func]&&t[r.func].apply(t,r.args)};window.addEventListener?window.addEventListener("message",n):window.attachEvent("onmessage",n)}},{key:"sendMessage",value:function(t,n,r){var a={func:n,args:r},i=e.isIe?JSON.stringify(a):a;t.postMessage(i,"*")}},{key:"isIe",get:function(){return"undefined"==typeof is||is.ie()}}]),e}();t["default"]=a},,,,,,,,function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(12),u=r(o),s=n(23),l=r(s),c=n(22),f=r(c),d=function(){function e(){a(this,e),this.params(),this.visualBulder=null,this.hashApi=new f["default"],window.parent!==window&&window.parent.FrontendMonster&&window.parent.FrontendMonster.hasBuilder&&(this.VisualFrame=new l["default"]),"undefined"!=typeof smoothScroll&&smoothScroll.init()}return i(e,[{key:"params",value:function(){var e=window.FrontendMonsterSettings||{},t={};Object.keys(e).forEach(function(n){t[n]=e[n]}),this.settings=t}},{key:"builder",get:function(){return null===this.visualBulder&&(this.visualBulder=new u["default"]),this.visualBulder}},{key:"hasBuilder",get:function(){return 1===this.builder.$builder.length}}]),e}();t["default"]=d},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(17),u=r(o),s=n(15),l=r(s),c=n(14),f=r(c),d=n(13),p=r(d),h=n(16),y=r(h),v=n(3),m=r(v),b=function(){function e(){a(this,e),this.params(),this.resolutionSwitcher(),this.environments=new Map([["site-structure",new u["default"](this,"site-structure")],["page-structure",new y["default"](this,"page-structure")],["materials",new l["default"](this,"materials")],["customization",new f["default"](this,"customization")],["action",new p["default"](this,"action")]]),this.environmentSelector(),this.switchEnvironment("site-structure"),$(".monster-environment-selector__environment-link").first().mod("active",!0),m["default"].bindMessageListener(this),this.controls()}return i(e,[{key:"params",value:function(){var e=window.VisualBuilderSettings||{},t={"element-selector":".monster-visual-builder","frame-selector":".monster-visual-frame",bundles:{},"stackable-container-class":"monster-stackable-container","new-block-url":"/monster/visual-builder/new-block"};Object.keys(e).forEach(function(n){t[n]=e[n]}),this.settings=t,this.$builder=$(this.settings["element-selector"]),this.$stackable=$("."+this.settings["stackable-container-class"])}},{key:"resolutionSwitcher",value:function(){var e=this,t="resolution-switcher__resolution-link",n=$("."+t);n.click(function(){return n.mod("active",!1),$(e.settings["frame-selector"]).width($(this).data("resolutionWidth")),$(this).mod("active",!0),!1})}},{key:"environmentSelector",value:function(){var e=this,t="monster-environment-selector__environment-link",n=$("."+t);n.click(function(){var t=$(this).data("environmentName");return e.currentEnvironment===t?(n.mod("active",!1),e.environments.get(t).deactivate(),e.currentEnvironment=null,!1):(n.mod("active",!1),e.switchEnvironment(t),$(this).mod("active",!0),!1)})}},{key:"switchEnvironment",value:function(e){this.environments.get(e).activate(),this.currentEnvironment=e}},{key:"clearStackable",value:function(){this.$stackable.empty()}},{key:"createStackablePane",value:function(){var e=this.settings["stackable-container-class"]+"__pane",t=0===this.$stackable.find("."+e).length?e+"_first":"",n=$('<div class="'+e+" "+t+'"></div>');return this.$stackable.append(n),n}},{key:"materialByName",value:function(e){return this.settings.materials.hasOwnProperty(e)?this.settings.materials[e]:null}},{key:"serialize",value:function(){var e=this.environments.get("page-structure").serializePage();console.log(e);var t={},n=this.frameContentWindow.MONSTER_EDIT_MODE_DATA.template.providedKeys;return Object.keys(n).forEach(function(r){t[r]={};var a=n[r];Object.keys(a).forEach(function(n){if(e.hasOwnProperty(n)!==!1){t[r][n]={};var i=a[n];Object.keys(i).forEach(function(a){if(e[n].hasOwnProperty(a)!==!1){t[r][n][a]={};var o=i[a];o.forEach(function(i){e[n][a].hasOwnProperty(i)!==!1&&(t[r][n][a][i]=e[n][a][i])})}})}})}),console.log(t),t}},{key:"pageChanged",value:function(){this.environments.forEach(function(e){return e.pageChanged()})}},{key:"log",value:function(e){console.log(e)}},{key:"controls",value:function(){var e=this;this.$controls=this.$builder.find(".controls").first(),this.$controls.elem("refresh").click(function(){return e.frameContentWindow.location.reload(),!1}),this.$controls.elem("save").click(function(){return m["default"].sendMessage(e.frameContentWindow,"save"),!1})}},{key:"frameContentWindow",get:function(){return $(this.settings["frame-selector"])[0].contentWindow}}]),e}();t["default"]=b},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=n(1),s=r(u),l=function(e){function t(){return a(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),t}(s["default"]);t["default"]=l},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=n(1),s=r(u),l=function(e){function t(){return a(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),t}(s["default"]);t["default"]=l},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=function d(e,t,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,t);if(void 0===r){var a=Object.getPrototypeOf(e);return null===a?void 0:d(a,t,n)}if("value"in r)return r.value;var i=r.get;if(void 0!==i)return i.call(n)},l=n(1),c=r(l),f=function(e){function t(e,n){a(this,t);var r=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return r.initMaterialsSelector(),r}return o(t,e),u(t,[{key:"initMaterialsSelector",value:function(){var e=this;this.$materialsGroups=$('<ul class="materials-groups"></ul>'),this.$materialsList=[],this.visualBuilder.settings.bundles.forEach(function(t){var n="undefined"!=typeof polyglot?polyglot.t(t.name):t.name,r='\n      <li class="materials-groups__item materials-groups__item--bundle-label">\n        <a href="#" class="materials-groups__switch-bundle" data-bundle-path="'+t.fullPath+'">\n            '+n+"\n        </a>\n      </li>\n      ";e.$materialsList.push(r),t.groups.forEach(function(t){var n=t.name,r=t.materials,a="undefined"!=typeof polyglot?polyglot.t(n):n,i=$('\n    <li class="materials-groups__item">\n      <a href="#" data-group-path="'+t.fullPath+'" class="materials-groups__switch-group">\n        '+a+' <span class="materials-groups__count">('+r.length+")</span>\n      </a>\n    </li>");e.$materialsGroups.append(i);var o=$('<ul class="materials-list" data-group-path="'+t.fullPath+'"></ul>'),u=[];r.forEach(function(e){var t=e.name,n="undefined"!=typeof polyglot?polyglot.t(t):t,r=$('\n<li>\n  <a href="#" class="materials-list__item" data-material-path="'+e.fullPath+'">\n    '+n+"\n  </a>\n</li>\n");u.push(r)}),o.append(u),e.$materialsList.push(o)})});var t=this;$(document).on("click",".materials-groups__switch-group",function(){var e=$(this);e.toggleMod("active");var n=e.data("groupPath");return e.mod("active")?($(".materials-groups__switch-group").mod("active",!1),$(".materials-list").each(function(){var e=$(this);e.mod("active")&&e.mod("active",!1),e.data("groupPath")===n&&e.mod("active",!0)}),e.mod("active",!0),t.$materialsPane.show()):t.$materialsPane.hide(),!1}),$(document).on("click",".materials-list__item",function(){t.sendMessage("newBlock",[$(this).data("materialPath"),"content"])})}},{key:"activate",value:function(){s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"activate",this).call(this),this.$groupsPane=this.visualBuilder.createStackablePane(),this.$groupsPane.append(this.$materialsGroups),this.$materialsPane=this.visualBuilder.createStackablePane(),this.$materialsPane.append(this.$materialsList),this.$materialsPane.hide(),$(".materials-groups__switch-group").mod("active",!1)}}]),t}(c["default"]);t["default"]=f},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=function d(e,t,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,t);if(void 0===r){var a=Object.getPrototypeOf(e);return null===a?void 0:d(a,t,n)}if("value"in r)return r.value;var i=r.get;if(void 0!==i)return i.call(n)},l=n(1),c=r(l),f=function(e){function t(e,n){a(this,t);var r=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return r.initPageStructureElement(),r.editModeData={},r}return o(t,e),u(t,[{key:"initPageStructureElement",value:function(){this.$pageStructure=$('<div class="page-structure"></div>')}},{key:"activate",value:function(){s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"activate",this).call(this),this.$structurePane=this.visualBuilder.createStackablePane(),this.$structurePane.append(this.$pageStructure)}},{key:"pageChanged",value:function(){var e=this;s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"pageChanged",this).call(this),this.$pageStructure.jstree("destroy");var n=this.target.MONSTER_EDIT_MODE_DATA.layout,r=this.target.MONSTER_EDIT_MODE_DATA.template,a={data:{id:"layout",templateId:n.id},text:"Layout - "+n.key+" #"+n.id,icon:"fa fa-columns",state:{opened:!0},children:[]},i={data:{id:"template",templateId:r.id},text:"Template - "+r.key+" #"+r.id,icon:"fa fa-th",state:{opened:!0},children:[]},o=this.target$(".m-monster-content__layout");o.each(function(){var e=t.processLayout($(this));a.children.push(e.item),e.templateRegions.forEach(function(e){i.children.push(e)})}),this.pageStructure=[a,i],this.$pageStructure.jstree({core:{data:this.pageStructure,themes:{name:"default-dark"}},plugins:["types","wholerow"],types:{layout:{icon:"fa fa-columns"},template:{icon:"fa fa-th"},templateRegion:{icon:"fa fa-folder-o"},contentTemplateRegion:{icon:"fa fa-folder"},material:{icon:"fa fa-puzzle-piece"}}});var u=this.$pageStructure.jstree();this.$pageStructure.on("loaded.jstree",function(){e.pageStructureJson=u.get_json(e.$pageStructure,{no_state:!0,no_id:!0,no_li_attr:!0,no_a_attr:!0}),e.target.FrontendMonster.VisualFrame.pageStructureJson=e.pageStructureJson}),this.editModeData=this.target.MONSTER_EDIT_MODE_DATA}},{key:"serializePage",value:function(){var e=this,t={};return Object.keys(this.regionsStructure).forEach(function(n){var r=e.regionsStructure[n];t[r.key]=r.serialize()}),t}},{key:"materialsByRegions",value:function(){var e=this,t={};return Object.keys(this.regionsStructure).forEach(function(n){var r=e.regionsStructure[n];t[r.key]=r.materialsDecl()}),t}}],[{key:"processLayout",value:function(e){var n=t.extractRegionData(e);n.state={opened:!0},n.children=[],n.data.id="layout.templateRegion."+n.data.regionKey;var r=[],a=e.find(">[data-is-material]");return a.each(function(){var e=$(this),a=t.processLayoutMaterial(e,n.id),i=a.layoutMaterial;a.templateRegions.forEach(function(e){r.push(e)}),n.children.push(i)}),{item:n,templateRegions:r}}},{key:"processLayoutMaterial",value:function(e,n){var r=e.data("materialIndex"),a=e.data("materialPath"),i={text:("core.frontend-monster-core.general.content-placeholder"===a?"Main Entity Content":"Material: "+r)+"\n      ",type:"material",data:{id:n+"."+r,materialIndex:r,materialPath:a,editableKeys:e.data("editableKeys"),node:e}},o=[],u=e.find("> .m-monster-content__content");return u.each(function(){var e=t.processTemplateRegion($(this));o.push(e)}),o.length>0&&(i.data.isContent=!0),{layoutMaterial:i,templateRegions:o}}},{key:"processTemplateRegion",value:function(e){var n=t.extractRegionData(e);n.state={opened:!0},n.children=[],n.data.entityDependent=1===e.data("regionEntityDependent");var r=n.data.entityDependent?"template":"content";n.data.id=r+".templateRegion."+n.data.regionKey,n.data.entityDependent&&(n.type="contentTemplateRegion");var a=e.find(">[data-is-material]");return a.each(function(){n.children.push(t.processTemplateRegionMaterial($(this),n.data.id))}),n}},{key:"processTemplateRegionMaterial",value:function(e,t){var n=e.data("materialIndex"),r=e.data("materialPath");return{text:"Material: "+n,type:"material",data:{id:t+"."+n,materialIndex:n,materialPath:r,editableKeys:e.data("editableKeys"),node:e}}}},{key:"extractRegionData",value:function(e){return{text:e.data("contentDescription"),type:"templateRegion",data:{regionId:e.data("regionId"),regionKey:e.data("regionKey"),uniqueContentId:e.data("uniqueContentId"),node:e}}}}]),t}(c["default"]);t["default"]=f},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=n(1),s=r(u),l=function(e){function t(){return a(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),t}(s["default"]);t["default"]=l},function(e,t){"use strict";e.exports=function(e,t){"undefined"==typeof e&&(e="");var n,r=function(e,t){return e=parseInt(e,10).toString(16),t<e.length?e.slice(e.length-t):t>e.length?Array(1+(t-e.length)).join("0")+e:e},a="undefined"!=typeof window?window:GLOBAL;a.$locutus=a.$locutus||{};var i=a.$locutus;return i.php=i.php||{},i.php.uniqidSeed||(i.php.uniqidSeed=Math.floor(123456789*Math.random())),i.php.uniqidSeed++,n=e,n+=r(parseInt((new Date).getTime()/1e3,10),8),n+=r(i.php.uniqidSeed,5),t&&(n+=(10*Math.random()).toFixed(8).toString()),n}},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(t,r){n(this,e),this.className=t,this.providedKeys=r,this.associations={},this.associate()}return r(e,[{key:"associate",value:function(){var e=this;this.associations={},Object.keys(this.providedKeys).forEach(function(t){var n=e.providedKeys[t],r=$('[data-region-key="'+t+'"]').first(),a={};Object.keys(n).forEach(function(t){var i=n[t],o=r.find('[data-material-index="'+t+'"]').first();if(0!==o.length){a[t]={dataKeys:i,$material:o};var u=o.data("editableKeys");e.initializeMaterialEdit(u,o,i)}}),e.associations[t]={$region:r,materials:a}})}},{key:"initializeMaterialEdit",value:function(t,n,r){var a=this,i=arguments.length<=3||void 0===arguments[3]?"":arguments[3];r.forEach(function(r){var o=t[r]||"NO_SUCH_KEY";if("NO_SUCH_KEY"!==o)if(o===Object(o))!function(){var e=n.find('[data-recursive-item="'+r+'"]'),t=a,i=0;e.each(function(){var e=$(this);t.initializeMaterialEdit(o,e,Object.keys(o),"item."),i++})}();else{var u=n.find('[data-editable-key="'+i+r+'"]').first();if(0===u.length)return;e.editable.initializeEditable(u)}})}},{key:"serializeKeys",value:function(){var e=this,t={};return Object.keys(this.associations).forEach(function(n){var r=e.associations[n],a=r.$region;t[n]={},Object.keys(r.materials).forEach(function(i){var o=r.materials[i].dataKeys,u=r.materials[i].$material;t[n][i]=e.serializeMaterial(n,i,o,a,u)})}),t}},{key:"serialize",value:function(){var e={"class":this.className};return this.fillConfig(e)}},{key:"fillConfig",value:function(e){return e}},{key:"serializeMaterial",value:function(e,t,n,r,a){return null}}],[{key:"editable",get:function(){return window.FrontendMonster.VisualFrame.editable}}]),e}();t["default"]=a},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(29),u=r(o),s=function(){function e(){a(this,e)}return i(e,null,[{key:"factory",value:function(e,t){var n=null,r=e.className||"DotPlant\\Monster\\DataEntity\\StaticContentProvider";switch(r){case"DotPlant\\Monster\\DataEntity\\StaticContentProvider":default:n=new u["default"](t)}return n}}]),e}();t["default"]=s},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(25),s=r(u),l=function(){function e(){a(this,e),this.editablesByType={},(0,s["default"])(),this.editablesByType=window.MONSTER_EDITABLES}return o(e,[{key:"serializeEditable",value:function(e){var t=e.data("editableParams");if("object"!==("undefined"==typeof t?"undefined":i(t)))return!1;var n=t.hasOwnProperty("type")?t.type:"string";this.editablesByType.hasOwnProperty(n)===!1&&(n="string");var r=t.hasOwnProperty("target")?t.target:"data";return this.editablesByType[n].serializeNode(e,r)}},{key:"initializeEditable",value:function(e){var t=e.data("editable-type")||"uneditable";if("uneditable"===t)return null;var n=this.editablesByType[t]||this.editablesByType.string;return n.initializeEditable(e)}}]),e}();t["default"]=l},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(){if(n(this,e),this.functionCalls={},document.location.hash){var t=document.location.hash.match(/#hashApi:(.*?):\/hashApi/);if(t&&2===t.length){var r=JSON.parse(decodeURIComponent(t[1])),a=!0,i=!1,o=void 0;try{for(var u,s=r[Symbol.iterator]();!(a=(u=s.next()).done);a=!0){var l=u.value;l.func&&(this.functionCalls[l.func]=l.args||{})}}catch(c){i=!0,o=c}finally{try{!a&&s["return"]&&s["return"]()}finally{if(i)throw o}}}}}return r(e,[{key:"shouldCall",value:function(e){return this.functionCalls[e]||!1}}]),e}();t["default"]=a},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(3),u=r(o),s=n(18),l=r(s),c=n(20),f=r(c),d=n(21),p=r(d),h=function(){function e(){a(this,e),this.params(),this.initialize()}return i(e,[{key:"initialize",value:function(){var e=this;u["default"].bindMessageListener(this),this.pageStructureJsonData=null,this.parentWindow=window.parent,this.parentMonster=this.parentWindow.FrontendMonster,this.parentBuilder=this.parentMonster.builder,this.currentMonsterContent=!1,this.editable=new p["default"],this.makeItMove(),$(window).resize(function(){return e.updateHandlers(),!0}),$(function(){e.parentBuilder.pageChanged(),e.initProviders()}),this.MonsterEditData=window.MONSTER_EDIT_MODE_DATA}},{key:"initProviders",value:function(){this.providers={layout:this.getProviders(this.MonsterEditData.layout),template:this.getProviders(this.MonsterEditData.template),entity:this.getProviders(this.MonsterEditData.entity)}}},{key:"getProviders",value:function(e){var t={};return Object.keys(e.providers).forEach(function(n){var r=e.providers[n];t[n]=f["default"].factory(r,e.providedKeys[n]||{})}),t}},{key:"refreshMonsterContentCache",value:function(){this.$monsterContentCache={};var e=this;$(this.settings["monster-content-selector"]).each(function(){e.currentMonsterContent||(e.currentMonsterContent=$(this).data("uniqueContentId")),e.$monsterContentCache[$(this).data("uniqueContentId")]=$(this)})}},{key:"updateHandlers",value:function(){this.$selectedMaterial&&this.$handlers&&(this.$handlers.css("top",this.$selectedMaterial.position().top+this.$selectedMaterial.height()-this.$handlers.height()),this.$selectedMaterial.mod("active",!0))}},{key:"makeItMove",value:function(){this.$handlers=$('\n<div class="monster-block-handlers">\n  <a href="#" class="monster-block-handlers__configure">\n    <i class="fa fa-cog"></i>\n  </a>\n  <span class="monster-block-handlers__block-name">Block name here</span>\n  <a href="#" class="monster-block-handlers__move-up">\n    <i class="fa fa-angle-up"></i>\n  </a>\n  <a href="#" class="monster-block-handlers__move-down">\n    <i class="fa fa-angle-down"></i>\n  </a>\n  <a href="#" class="monster-block-handlers__clone">\n    <i class="fa fa-clone"></i>\n  </a>\n  <a href="#" class="monster-block-handlers__remove">\n    <i class="fa fa-times"></i>\n  </a>\n</div>'),$("body").append(this.$handlers),this.$handlers.hide();var e=this;$(this.settings["monster-content-selector"]).on({mouseenter:function(){var e=$(this);e.addClass("m-monster-content__material--highlighted")},mouseleave:function(){var e=$(this);e.removeClass("m-monster-content__material--highlighted")},click:function(){var t=$(this);e.selectMaterial(t)}},"[data-is-material]"),e.$handlers.on("click",".monster-block-handlers__move-up",function(){if(e.$selectedMaterial){var t=e.$selectedMaterial.prev("[data-is-material]");1===t.length&&(e.$selectedMaterial.insertBefore(t),e.updateHandlers(),e.parentBuilder.pageChanged())}return!1}).on("click",".monster-block-handlers__move-down",function(){if(e.$selectedMaterial){var t=e.$selectedMaterial.next("[data-is-material]");1===t.length&&(e.$selectedMaterial.insertAfter(t),e.updateHandlers(),e.parentBuilder.pageChanged())}return!1}).on("click",".monster-block-handlers__clone",function(){if(e.$selectedMaterial){var t=e.$selectedMaterial.clone(),n=(0,l["default"])("mat");t.insertAfter(e.$selectedMaterial).data("materialIndex",n).attr("data-material-index",n),e.selectMaterial(t),e.parentBuilder.pageChanged()}return!1}).on("click",".monster-block-handlers__remove",function(){return e.$selectedMaterial&&confirm("Are you sure you want to remove this material?")&&(e.$selectedMaterial.remove(),e.$selectedMaterial=null,e.$handlers.hide(),e.parentBuilder.pageChanged()),!1})}},{key:"selectMaterial",value:function(e){this.$selectedMaterial!==e&&(this.$selectedMaterial&&this.$selectedMaterial.mod("active",!1),this.$selectedMaterial=e,this.updateHandlers(),this.$handlers.show())}},{key:"serializeContent",value:function(e){var t=this,n={},r=this;Object.keys(this.$monsterContent).forEach(function(e){var a=t.$monsterContent[e];n[a.data("uniqueContentId")]=r.serializeUniqueContent(a)}),this.sendToBuilder(e,[n])}},{key:"serializeUniqueContent",value:function(e){var t={};return t.uniqueContentId=e.data("uniqueContentId"),t.materials={},e.find("[data-is-material='1']").each(function(){var e={};e.block=$(this).data("materialBlock"),t.materials[$(this).data("materialIndex")]=e}),t}},{key:"params",value:function(){var e=window.VisualFrameSettings||{},t={"monster-content-selector":".m-monster-content__content"};Object.keys(e).forEach(function(n){t[n]=e[n]}),this.settings=t}},{key:"sendToBuilder",value:function(e,t){u["default"].sendMessage(this.parentWindow,e,t)}},{key:"constructTemplateData",value:function(){return{providersEntities:this.parentBuilder.serialize(),regionsMaterials:this.parentBuilder.environments.get("page-structure").materialsByRegions()}}},{key:"newBlock",value:function(t,n){var r=(0,l["default"])("mat"),a=this.iterateTemplateType(this.pageStructureJson);return a.entity.regionsMaterials.hasOwnProperty(n)===!1&&(a.entity.regionsMaterials[n]={}),a.entity.regionsMaterials[n].decl[r]={material:t},a.entity.regionsMaterials[n].materialsOrder.push(r),e.formSubmit(a),!1}},{key:"save",value:function(){var t=this.iterateTemplateType(this.pageStructureJson);return t.action="save",e.formSubmit(t),!1}},{key:"iterateTemplateType",value:function(t){var n=this,r={entity:{materialsByRegionDecl:{},providers:{}}};return t.forEach(function(t){var a=t.data.id,i=e.iterateTemplateRegions(t.children);r[a]={templateRegions:i.templateRegions,templateId:t.data.templateId,providers:{}},Object.keys(i.entityMaterials).length>0&&Object.keys(i.entityMaterials).forEach(function(e){r.entity.materialsByRegionDecl[e]=i.entityMaterials[e]}),r[a].providers=n.serializeProviders(a)}),r.entity.providers=this.serializeProviders("entity"),r}},{key:"serializeProviders",value:function(e){var t=this,n={};return Object.keys(this.providers[e]).forEach(function(r){n[r]=t.providers[e][r].serialize()}),n}},{key:"pageStructureJson",set:function(e){
this.pageStructureJsonData=e},get:function(){return this.pageStructureJsonData}},{key:"$monsterContent",get:function(){return this.$monsterContentCache?this.$monsterContentCache:(this.refreshMonsterContentCache(),this.$monsterContentCache)}}],[{key:"formSubmit",value:function(e){var t=$('<form method="POST"></form>'),n=$('<input type="hidden" name="__json">'),r=$('<input type="hidden">');r.attr("name",$("meta[name=csrf-param]").attr("content")).val($("meta[name=csrf-token]").attr("content")).appendTo(t),n.val(JSON.stringify(e)).appendTo(t),t[0].submit()}},{key:"iterateTemplateRegions",value:function(t){var n={templateRegions:{},templateRegionsOrder:[],entityMaterials:{}};return t.forEach(function(t){var r=t.data.regionKey;n.templateRegionsOrder.push(r);var a=t.data.entityDependent||!1,i=e.iterateMaterials(t.children,r);a===!1?n.templateRegions[r]={regionId:t.data.regionId,regionKey:r,uniqueContentId:t.data.uniqueContentId,materialsDecls:i,entityDependent:a}:(n.templateRegions[r]={regionId:t.data.regionId,regionKey:r,uniqueContentId:t.data.uniqueContentId,entityDependent:a},n.entityMaterials[r]=i)}),n}},{key:"iterateMaterials",value:function(e,t){var n={decl:{},materialsOrder:[]};return e.forEach(function(e){var t=e.data.materialIndex;n.decl[t]={material:e.data.materialPath},n.materialsOrder.push(t)}),n}}]),e}();t["default"]=h},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(2),l=r(s),c=function(e){function t(){return a(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),u(t,[{key:"serializeNode",value:function(e){var t=l["default"].frame$(e),n=t.data("editor");return n?n.getData():t.html()}},{key:"initializeEditable",value:function(e){var t=e[0],n={autoParagraph:!1,enableContentEditable:!0,ignoreEmptyParagraph:!0,enterMode:window.CKEDITOR.ENTER_BR},r=window.AlloyEditor.editable(t,n).get("nativeEditor");e.data("editor",r)}}]),t}(l["default"]);t["default"]=c},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function a(){"undefined"==typeof window.MONSTER_EDITABLES&&(window.MONSTER_EDITABLES={}),window.MONSTER_EDITABLES.wysiwyg=new o["default"],window.MONSTER_EDITABLES.link=new c["default"],window.MONSTER_EDITABLES.image=new s["default"],window.MONSTER_EDITABLES.string=new d["default"]}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=a;var i=n(24),o=r(i),u=n(26),s=r(u),l=n(27),c=r(l),f=n(28),d=r(f)},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(2),l=r(s),c=function(e){function t(){return a(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),u(t,[{key:"serializeNode",value:function(e){var t=e.find("img").first();return{src:t.attr("src"),alt:t.attr("alt")}}}]),t}(l["default"]);t["default"]=c},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(2),l=r(s),c=function(e){function t(){return a(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),u(t,[{key:"serializeNode",value:function(e){return{href:e.data("originalHref")?e.data("originalHref"):e.attr("href"),anchor:e.html()}}}]),t}(l["default"]);t["default"]=c},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(2),l=r(s),c=function(e){function t(){return a(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),u(t,[{key:"serializeNode",value:function(e){var t=l["default"].frame$(e),n=t.data("editor");return n?n.getData():t.html()}},{key:"initializeEditable",value:function(e){var t=e[0],n={allowedContent:"i u",toolbars:{styles:{selections:window.AlloyEditor.Selections,tabIndex:1}},autoParagraph:!1,enableContentEditable:!0,ignoreEmptyParagraph:!0,blockless:!0,enterMode:window.CKEDITOR.ENTER_BR};try{var r=window.AlloyEditor.editable(t,n).get("nativeEditor");r.on("key",function(e){13!==e.data.keyCode&&e.data.keyCode!==window.CKEDITOR.SHIFT+13||e.cancel()}),r.on("paste",function(e){e.data.dataValue=e.data.dataValue.replace(/<br[\s\/]*>/gim," ")}),e.data("editor",r)}catch(a){console.log(e,t)}}}]),t}(l["default"]);t["default"]=c},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(19),l=r(s),c=function(e){function t(e){return a(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"DotPlant\\Monster\\DataEntity\\StaticContentProvider",e))}return o(t,e),u(t,[{key:"fillConfig",value:function(e){var t=e;return t.entities=this.serializeKeys(),t}},{key:"serializeMaterial",value:function(e,t,n,r,a){var i=a.data("editableKeys"),o=this.recursiveSerialize(i,a,n);return o}},{key:"recursiveSerialize",value:function(e,t,n){var r=this,a=arguments.length<=3||void 0===arguments[3]?"":arguments[3],i={};return n.forEach(function(n){var o=e[n]||"NO_SUCH_KEY";if("NO_SUCH_KEY"!==o)if(o===Object(o))!function(){var e=t.find('[data-recursive-item="'+n+'"]'),a=r,u=0;i[n]=[],e.each(function(){var e=$(this);i[n].push(a.recursiveSerialize(o,e,Object.keys(o),"item.")),u++})}();else{var u=t.find('[data-editable-key="'+a+n+'"]').first();if(0===u.length)return void console.warn('Skipped [data-editable-key="'+a+n+'"] as not found');i[n]=l["default"].editable.serializeEditable(u)}}),i}}]),t}(l["default"]);t["default"]=c},,,function(e,t){}]);